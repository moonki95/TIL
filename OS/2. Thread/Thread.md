## **1. 스레드의 개념**

* **스레드**

  * **CPU 이용의 기본 단위**
  * 스레드 ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성
  * 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 열린 파일 및 신호와 같은 OS 자원 공유
  * 현대의 컴퓨터에서 동작하는 대부분의 SW는 **다중 스레드 사용**
    * ex) 웹 서버가 단일 스레드로 동작한다면 자신의 하나의 프로세스로 한 번에 하나의 클라이언트만 서비스할 수 있게 되어 클라이언트는 매우 긴 시간을 기다려야함
    * 따라서 다중 스레드화로 설계하면 서버는 클라이언트의 요청을 listen하는 별도의 스레드를 생성한다. 즉 하나의 요청이 들어오면 프로세스를 계속 생성하는게 아니라, 새로운 스레드를 생성하고 추가적인 요청을 listen 하기 위한 작업을 재개

## **2. 다중 스레드**

* **다중 스레드 장점**
  
  * **응답성(Responsiveness)**
    * 응용프로그램이 긴 작업을 수행하더라도 하나의 연산이 끝날때까지 기다리지 않고 프로그램의 수행이 계속되어 사용자의 응답성이 향상됨
  * **자원 공유(Resource sharing)**
    * 프로세스는 공유 메모리와 메시지 전달기법을 통해 자원을 공유하는 반면에, 스레드는 자동적으로 그들이 속한 프로세스의 자원들과 메모리를 공유함 -> 코드와 데이터 공유의 이점으로 한 응용 프로그램이 같은 주소 공간 내에 여러 개의 다른 작업을 하는 스레드를 가짐
  * **경제성(Economy)**
    * 프로세스 생성을 위해 메모리와 자원을 할당하는 것은 비용이 많이 드는 반면에, 스레드는 자신이 속한 프로세스의 자원들을 공유하기 때문에 스레드를 생성하고 Context Switching을 하는 것이 더 경제적이다.
  * **규모 적응성(Scalability)**
    * 각각의 스레드가 다른 처리기에서 병렬로 수행될 수 있기 때문에 이점을 가짐

* **병렬실행**

  * **데이터 병렬 실행**
    * 동일한 데이터의 부분집합을 다수의 계산 코어에 분배한 뒤 각 코어에서 동일한 연산을 실행하는 데 초점을 둠
    * 크기가 N인 배열의 내용을 더하는 경우  
      * [0] ~ [N/2 - 1] + [N/2] ~ [N-1] 까지 더해 병렬실행이 가능
  * **태스크 병렬 실행**
    * 데이터가 아닌 스레드를 다수의 코어에 분배하고 각 스레드는 고유의 연산을 실행

* **다중 스레드 모델**

  * **커널 스레드**
    * OS에 의해 직접 지원되고 관리됨
  * **사용자 스레드** 
    * 커널 위에서 지원되며 커널의 지원 없이 관리 됨
    * **다대일 모델**
      * 많은 사용자 수준의 스레드를 하나의 커널 스레드로 사상함(스레드 관리는 사용자 공간의 스레드 라이브러리에 의해 행해짐)
      * 한 스레드가 봉쇄형 시스템 호출을 할 경우, 전체 스레드가 봉쇄되며, 한 번에 하나의 스레드만이 커널에 접근할 수 있기 때문에 **다중 스레드가 다중코어 시스템에서 병렬로 실행될 수 없음**
      * 거의 사용되지 않음
    * **일대일 모델**
      * 각 사용자 스레드를 각각 하나의 커널 스레드로 사상
      * 하나의 스레드가 봉쇄형 시스템 호출을 호출하더라도 다른 스레드가 실행될 수 있어 **다대일 모델보다 더 많은 병렬성 제공**
      * 사용자 수준 스레드를 생성할 때 그에 따른 커널 스레드를 생성해야함 -> 개발자가 너무 많은 스레드를 생성하지 않도록 주의
      * Windows OS 및 Linux가 일대일 모델 구현
    * **다대다 모델**
      * 여러 개의 사용자 수준 스레드를 그보다 작은 수 혹은 같은 수의 커널 스레드로 멀티플렉스 함
      * 다대일 모델과 일대일 모델의 단점을 보완
      * 변형된 모델로 두 수준 모델이라고 불림

## **3. 스레드 라이브러리**

  * **스레드 라이브러리**
    * 프로그래머에게 스레드를 생성하고 관리하기 위한 API를 제공
    * 스레드 라이브러리 구현 방법
      * 커널의 지원 없이 완전히 사용자 공간에서만 라이브러리 지원
        * 라이브러리의 모든 코드와 자료구조는 사용자 공간에 존재
      * OS에 의해 지원되는 커널 수준 라이브러리를 구현 
        * 라이브러리를 위한 모든 코드와 자료구조가 커널 공간에 존재
    * **POSIX Pthreads, Windows, Java** 세 종류의 라이브러리가 주로 사용
      * Posix Pthreads & Windows 스레드
        * 전역 변수로 선언된 데이터, 함수 외부에 선언된 데이터는 같은 프로세스에 속한 모든 스레드가 공유
      * Java 스레드
        * 전역 데이터의 개념이 없기 때문에 공유 데이터에 대한 접근이 스레드 사이에 명시적으로 조정되어야 함
    * 동기 스레딩
      * 부모 스레드가 하나 이상의 자식 스레드를 생성하고 자식 스레드 모두가 종료할 때까지 기다렸다가 자신의 실행을 재개하는 방식
  
## **4. 암묵적 스레딩**

  * **스레드 풀**
    * 프로세스를 시작할 때 아예 일정한 수의 스레드를 미리 만들어 두는 것
    * 이 스레드들은 평소에 하는 일 없이 일감을 기다리다가 요청이 드러오면 이 풀에서 스레드에게 할당
    * 보통 스레드 풀에 있는 스레드 개수는 CPU 수, 물리 메모리 용량, 동시 요청 클라이언트 최대개수 등을 고려


## **5. 정리**

  * **프로세스 vs 스레드**
    * **프로세스는 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램을 의미**
    * 프로세스는 각각 독립된 메모리 영역(코드, 데이터, 스택, 힙)의 구조를 가짐
    * **스레드는 프로세스 내에서 실행되는 여러 흐름의 단위 및 프로세스로부터 할당받은 자원을 이용하는 단위를 뜻함**
    * 스레드는 프로세스 내에서 각각 스택만 할당받고 코드, 데이터, 힙 영역은 공유